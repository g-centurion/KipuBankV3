{
  "contractName": "KipuBankV3",
  "version": "1.0.0",
  "address": "0x...",
  "chainId": 11155111,
  "abi": [
    {
      "type": "function",
      "name": "deposit",
      "inputs": [],
      "outputs": [],
      "stateMutability": "payable",
      "description": "Deposit native ETH into the bank"
    },
    {
      "type": "function",
      "name": "depositAndSwapERC20",
      "inputs": [
        {
          "name": "tokenIn",
          "type": "address",
          "description": "Token address to swap"
        },
        {
          "name": "amountIn",
          "type": "uint256",
          "description": "Amount to deposit in token units"
        },
        {
          "name": "amountOutMin",
          "type": "uint256",
          "description": "Minimum USDC to receive (slippage protection)"
        },
        {
          "name": "deadline",
          "type": "uint48",
          "description": "Unix timestamp deadline"
        }
      ],
      "outputs": [],
      "stateMutability": "nonpayable",
      "description": "Deposit ERC20 token and swap to USDC"
    },
    {
      "type": "function",
      "name": "withdrawToken",
      "inputs": [
        {
          "name": "tokenAddress",
          "type": "address",
          "description": "0x0...0 for ETH, USDC address for USDC"
        },
        {
          "name": "amountToWithdraw",
          "type": "uint256",
          "description": "Amount to withdraw"
        }
      ],
      "outputs": [],
      "stateMutability": "nonpayable",
      "description": "Withdraw ETH or USDC from user balance"
    },
    {
      "type": "function",
      "name": "balances",
      "inputs": [
        {
          "name": "user",
          "type": "address"
        },
        {
          "name": "token",
          "type": "address"
        }
      ],
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "description": "Get user balance for a specific token"
    },
    {
      "type": "function",
      "name": "getDepositCount",
      "inputs": [],
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "description": "Get total number of deposits"
    },
    {
      "type": "function",
      "name": "getWethAddress",
      "inputs": [],
      "outputs": [
        {
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "description": "Get WETH address used for swaps"
    },
    {
      "type": "function",
      "name": "pause",
      "inputs": [],
      "outputs": [],
      "stateMutability": "nonpayable",
      "description": "Pause the contract (admin only)"
    },
    {
      "type": "function",
      "name": "unpause",
      "inputs": [],
      "outputs": [],
      "stateMutability": "nonpayable",
      "description": "Unpause the contract (admin only)"
    },
    {
      "type": "function",
      "name": "setEthPriceFeedAddress",
      "inputs": [
        {
          "name": "newAddress",
          "type": "address",
          "description": "New Chainlink price feed address"
        }
      ],
      "outputs": [],
      "stateMutability": "nonpayable",
      "description": "Update ETH/USD price feed (admin only)"
    },
    {
      "type": "function",
      "name": "addOrUpdateToken",
      "inputs": [
        {
          "name": "token",
          "type": "address",
          "description": "Token address"
        },
        {
          "name": "priceFeed",
          "type": "address",
          "description": "Chainlink price feed for the token"
        },
        {
          "name": "decimals",
          "type": "uint8",
          "description": "Token decimals"
        }
      ],
      "outputs": [],
      "stateMutability": "nonpayable",
      "description": "Register or update a token (admin only)"
    },
    {
      "type": "event",
      "name": "DepositSuccessful",
      "inputs": [
        {
          "name": "user",
          "type": "address",
          "indexed": true
        },
        {
          "name": "token",
          "type": "address",
          "indexed": true
        },
        {
          "name": "amount",
          "type": "uint256",
          "indexed": false
        }
      ],
      "description": "Emitted when a deposit is successful"
    },
    {
      "type": "event",
      "name": "WithdrawalSuccessful",
      "inputs": [
        {
          "name": "user",
          "type": "address",
          "indexed": true
        },
        {
          "name": "token",
          "type": "address",
          "indexed": true
        },
        {
          "name": "amount",
          "type": "uint256",
          "indexed": false
        }
      ],
      "description": "Emitted when a withdrawal is successful"
    },
    {
      "type": "function",
      "name": "BANK_CAP_USD",
      "inputs": [],
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "description": "Bank cap in USD (1M * 10^8)"
    },
    {
      "type": "function",
      "name": "MAX_WITHDRAWAL_PER_TX",
      "inputs": [],
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "description": "Max withdrawal per transaction"
    },
    {
      "type": "function",
      "name": "USDC_TOKEN",
      "inputs": [],
      "outputs": [
        {
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "description": "USDC token address"
    },
    {
      "type": "function",
      "name": "WETH_TOKEN",
      "inputs": [],
      "outputs": [
        {
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "description": "WETH token address"
    },
    {
      "type": "function",
      "name": "PRICE_FEED_TIMEOUT",
      "inputs": [],
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "description": "Maximum time for price feed to be valid (1 hour)"
    },
    {
      "type": "function",
      "name": "MAX_PRICE_DEVIATION_BPS",
      "inputs": [],
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "description": "Max allowed price deviation in basis points (500 = 5%)"
    }
  ],
  "errors": {
    "Bank__DepositExceedsCap": "The deposit exceeds the bank cap",
    "Bank__WithdrawalExceedsLimit": "Withdrawal exceeds per-transaction limit",
    "Bank__InsufficientBalance": "Insufficient balance for withdrawal",
    "Bank__TransferFailed": "Token transfer failed",
    "Bank__InvalidTokenAddress": "Invalid token address",
    "Bank__SlippageTooHigh": "Slippage too high",
    "Bank__ZeroAmount": "Amount cannot be zero",
    "Bank__TokenNotSupported": "Token not supported",
    "Bank__StalePrice": "Price feed is stale",
    "Bank__PriceDeviation": "Price deviated too much"
  }
}
